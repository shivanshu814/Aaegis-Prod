services:
  # Backend Service (tRPC API)
  - type: web
    name: aaegis-backend
    runtime: node
    region: oregon
    plan: free
    branch: main
    buildCommand: pnpm install --prod=false && pnpm turbo run build --filter=@aegis/backend...
    startCommand: cd services/backend && pnpm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 4000
      - key: ALLOWED_ORIGINS
        sync: false
      - key: MONGODB_URI
        value: mongodb+srv://aaegis-finance:AGS2025@aaegis-finance.dnkydig.mongodb.net/
      # Email/SMTP Configuration for Alerts
      - key: SMTP_HOST
        value: smtp.gmail.com
      - key: SMTP_PORT
        value: "587"
      - key: SMTP_SECURE
        value: "false"
      - key: SMTP_USER
        value: shivanshupathak814@gmail.com
      - key: SMTP_PASS
        value: ycedcjbresbdfgdj
      - key: SMTP_FROM
        value: '"Aegis Protocol" <shivanshupathak814@gmail.com>'
      - key: ADMIN_EMAIL
        value: shivanshupathak814@gmail.com
    healthCheckPath: /v1

  # Frontend Service (Next.js)
  - type: web
    name: aaegis-web
    runtime: node
    region: oregon
    plan: free
    branch: main
    buildCommand: pnpm install --prod=false && pnpm turbo run build --filter=@aaegis/web...
    startCommand: cd apps/web && pnpm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_BACKEND_URL
        sync: false

  # Guardian Service (Web)
  - type: web
    name: aaegis-guardian
    runtime: node
    region: oregon
    plan: free
    branch: main
    buildCommand: pnpm install --prod=false && pnpm turbo run build --filter=@aegis/guardian...
    startCommand: cd services/guardian && pnpm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 4001
      - key: MONGODB_URI
        value: mongodb+srv://aaegis-finance:AGS2025@aaegis-finance.dnkydig.mongodb.net/
      # Email/SMTP Configuration
      - key: SMTP_HOST
        value: smtp.gmail.com
      - key: SMTP_PORT
        value: "587"
      - key: SMTP_SECURE
        value: "false"
      - key: SMTP_USER
        value: shivanshupathak814@gmail.com
      - key: SMTP_PASS
        value: ycedcjbresbdfgdj
      - key: SMTP_FROM
        value: '"Aegis Protocol" <shivanshupathak814@gmail.com>'
      - key: ADMIN_EMAIL
        value: shivanshupathak814@gmail.com
    healthCheckPath: /health

  # Admin Service (Next.js)
  - type: web
    name: aaegis-admin
    runtime: node
    region: oregon
    plan: free
    branch: main
    buildCommand: pnpm install --prod=false && pnpm turbo run build --filter=@aaegis/admin...
    startCommand: cd apps/admin && pnpm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_BACKEND_URL
        sync: false
